<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mobile Card Game Engine</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      touch-action: none;
    }
    body, html {
      height: 100%;
      overflow: hidden;
      background-color: #2e2e2e;
      user-select: none;
      -webkit-user-select: none;
    }
    #game-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }
    .card {
      width: 18vw;
      max-width: 80px;
      aspect-ratio: 2/3;
      background-color: #1e1e1e;
      border-radius: 10px;
      border: 2px solid #000;
      position: absolute;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 4vw;
      font-weight: bold;
      cursor: grab;
      user-select: none;
      color: transparent;
      transition: transform 0.2s, color 0.2s;
    }
    .card.flipped {
      background-color: #ffffff;
      color: black;
    }
    .card.red {
      color: red;
    }
    .controls {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      z-index: 100;
      justify-content: center;
    }
    .controls > * {
      margin: 2px;
    }
    button, select, label {
      padding: 10px;
      font-size: 14px;
      border: none;
      border-radius: 6px;
      background-color: #444;
      color: white;
      cursor: pointer;
    }
    button:hover, select:hover {
      background-color: #666;
    }
    label input[type="checkbox"] {
      margin-right: 4px;
    }
  </style>
</head>
<body>
  <div id="game-container"></div>
  <div class="controls">
    <select id="deck-mode">
      <option value="normal">Normal Deck</option>
      <option value="5suits">+1 Extra Suit</option>
      <option value="6suits">+2 Extra Suits</option>
      <option value="extraRanks">+7 Extra Ranks</option>
    </select>
    <label><input type="checkbox" id="jokers">Jokers</label>
    <label><input type="checkbox" id="chips">Poker Chips</label>
    <label><input type="checkbox" id="duplicates">Unrestricted Shuffle</label>
    <button onclick="reshuffle()">Reshuffle</button>
    <button onclick="reset()">Reset</button>
    <button onclick="toggleFlipMode()" id="flip-toggle">Flip: Off</button>
  </div>
  <script>
    const gameContainer = document.getElementById("game-container");
    const cards = [];
    let flipMode = false;

    const baseSuits = ['♠', '♥', '♦', '♣'];
    const extraSuits = ['★', '✿'];
    const baseValues = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
    const extraValues = ['X', 'Y', 'Z', 'U', 'V', 'W', 'T'];

    function toggleFlipMode() {
      flipMode = !flipMode;
      document.getElementById("flip-toggle").textContent = "Flip: " + (flipMode ? "On" : "Off");
    }

    function createDeck() {
      const mode = document.getElementById("deck-mode").value;
      const jokers = document.getElementById("jokers").checked;
      const allowDuplicates = document.getElementById("duplicates").checked;

      let suits = [...baseSuits];
      let values = [...baseValues];

      if (mode === '5suits') suits.push(extraSuits[0]);
      if (mode === '6suits') suits.push(...extraSuits);
      if (mode === 'extraRanks') values.push(...extraValues);

      let deck = [];
      for (let suit of suits) {
        for (let value of values) {
          deck.push({ label: `${value}${suit}`, suit });
        }
      }

      if (jokers) {
        deck.push({ label: 'JOKER', suit: 'joker' });
        deck.push({ label: 'JOKER', suit: 'joker' });
      }

      if (allowDuplicates) {
        deck = [...deck, ...deck];
      }

      return deck;
    }

    function shuffle(deck) {
      for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
    }

    function getCenterPosition(card) {
      const rect = card.getBoundingClientRect();
      const centerX = window.innerWidth / 2 - rect.width / 2;
      const centerY = window.innerHeight / 2 - rect.height / 2;
      return { centerX, centerY };
    }

    function createCards(deck) {
      gameContainer.innerHTML = "";
      cards.length = 0;

      deck.forEach((data, index) => {
        const card = document.createElement("div");
        card.className = "card";
        card.textContent = data.label;
        card.dataset.suit = data.suit;
        card.style.zIndex = index;
        card.style.visibility = "hidden";
        gameContainer.appendChild(card);
        cards.push(card);
      });

      requestAnimationFrame(() => {
        cards.forEach((card, index) => {
          const { centerX, centerY } = getCenterPosition(card);
          card.style.left = `${centerX}px`;
          card.style.top = `${centerY}px`;
          card.style.visibility = "visible";

          let offsetX, offsetY;
          let isDragging = false;

          card.addEventListener("pointerdown", (e) => {
            offsetX = e.clientX - card.offsetLeft;
            offsetY = e.clientY - card.offsetTop;
            isDragging = true;
            card.setPointerCapture(e.pointerId);
          });

          card.addEventListener("pointermove", (e) => {
            if (!isDragging) return;
            card.style.left = `${e.clientX - offsetX}px`;
            card.style.top = `${e.clientY - offsetY}px`;
          });

          card.addEventListener("pointerup", (e) => {
            isDragging = false;
            card.releasePointerCapture(e.pointerId);
          });

          card.addEventListener("click", () => {
            if (!flipMode) return;
            card.classList.toggle("flipped");
            if (card.classList.contains("flipped")) {
              if (card.dataset.suit === '♥' || card.dataset.suit === '♦') {
                card.classList.add("red");
              }
            } else {
              card.classList.remove("red");
            }
          });
        });
      });
    }

    function reshuffle() {
      const deck = createDeck();
      shuffle(deck);

      cards.forEach((card, i) => {
        const data = deck[i];
        card.textContent = data.label;
        card.dataset.suit = data.suit;
        const { centerX, centerY } = getCenterPosition(card);
        card.style.left = `${centerX}px`;
        card.style.top = `${centerY}px`;
        card.style.zIndex = i;
        card.classList.remove("flipped", "red");
        card.style.color = "transparent";
      });
    }

    function reset() {
      const deck = createDeck();
      shuffle(deck);
      createCards(deck);
    }

    window.addEventListener("resize", () => {
      cards.forEach((card) => {
        const { centerX, centerY } = getCenterPosition(card);
        card.style.left = `${centerX}px`;
        card.style.top = `${centerY}px`;
      });
    });

    document.getElementById("deck-mode").addEventListener("change", reset);
    document.getElementById("jokers").addEventListener("change", reset);
    document.getElementById("chips").addEventListener("change", reset);
    document.getElementById("duplicates").addEventListener("change", reset);

    reset();
  </script>
</body>
</html>
